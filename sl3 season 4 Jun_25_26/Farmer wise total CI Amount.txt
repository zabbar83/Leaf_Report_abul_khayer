--Farmer Crop Inputs--*

Select fa.season_name              AS cropYear,
       fa.area_id                 AS areaId,
       fa.area_name                 AS areaName,
       fa.zone_id                 AS zoneId,
       fa.zone_name                 AS zoneName,
       fa.sub_area_id             AS subAreaId,
       fa.sub_area_name             AS subAreaName,
       fa.village_id              AS villageId,
       fa.village_name              AS villageName,
       fa.farmer_reg_number             AS farmerRegNum,
       fa.farmer_name                 AS farmerName,
       fa.farmer_father_name          AS fatherName,
       fa.mobile_no                   AS contactNumber,
       fa.nid                           AS nidNumber,
       fa.farmer_category                    AS category,
       case when f.is_active='true' then 'ACTIVE' else 'INACTIVE' end as farmerStatus,
       fa.land_acreage             AS cropAcre,
       fa.variety_name              AS varietyCode,
       fa.division_name               AS divisionName,
       fa.district_name             AS districtName,
       fa.thana_name                  AS thanaName,
       fa.union_name                  AS unionName,
       fa.bank_name                    AS bankName,
       fa.bank_branch_name                  AS branchName,
       fa.bank_account_number              AS bankAccNumber,         sum(coalesce(flm.loan_amount,0))     AS ciAmount
FROM    (select * from farmer_agreement
         Where season_name IN (
             SELECT
                 fiscal_year
             FROM    season s
             where   s.id = :seasonId
         )
           and (case when :areaId is not null then area_id = :areaId else true end)
           and (case when :zoneId is not null then zone_id = :zoneId else true end)
           and (case when :subAreaId is not null then sub_area_id = :subAreaId else true end)
           and (case when :villageId is not null then village_id = :villageId else true end)

        ) fa
            INNER    JOIN farmer f ON f.id=fa.farmer_id
            and f.is_active = 'true'
            JOIN farmer_loan_requests flr ON fa.id=flr.farmer_agreement_id
            JOIN farmer_loan_main flm ON flr.id = flm.farmer_loan_request_id
group by fa.season_name, fa.area_id, fa.area_name, fa.zone_id, fa.zone_name, fa.sub_area_id, fa.sub_area_name, fa.village_id, fa.village_name,
         fa.farmer_reg_number, fa.farmer_name, fa.farmer_father_name, fa.mobile_no, fa.nid, fa.farmer_category, fa.land_acreage, fa.variety_name,
         fa.division_name, fa.district_name, fa.thana_name, fa.union_name, fa.bank_name, fa.bank_branch_name, fa.bank_account_number,f.is_active
ORDER   BY fa.area_id, fa.zone_id, fa.sub_area_id, fa.village_id, fa.farmer_reg_number